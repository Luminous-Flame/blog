
##  **1 FHS란?**

- **정의**: 리눅스 및 유닉스 계열 시스템에서 파일 시스템의 디렉토리 구조를 표준화한 규격.
- **목적**:
    - 디렉토리 역할 분리.
    - 다른 배포판에서도 일관된 사용자 경험 보장.
    - 유지보수와 관리 효율성 향상.

---

### **1.1 주요 디렉토리 요약**
#### **/ (루트 디렉토리)**

- 파일 시스템 계층의 **최상위 디렉토리**.
- 모든 파일과 디렉토리의 시작점.
- **중요성**:
    - 시스템 부팅 및 작동에 필수적인 디렉토리들을 포함
    - 루트 디렉토리는 가급적 깨끗하게 유지

---

#### **/boot/**

- **역할**: 부팅에 필요한 **커널** 및 **부트 로더 파일** 저장.
- **내용물**:
    - `vmlinuz`: 커널 이미지 파일
    - `initrd.img`: 초기 램 디스크 이미지
    - `grub/`: GRUB 부트 로더 설정 디렉토리
- **주요 용도**:
    - 부팅 시 필요한 파일만 포함
    - 흔히 별도의 파티션으로 나누어 데이터 손상을 방지

---

#### **/dev/**

- **역할**: 시스템의 **장치 파일** 저장
- **내용물**:
    - `/dev/null`: 모든 데이터를 버리는 가상 장치
    - `/dev/sda`: 첫 번째 SATA 디스크
    - `/dev/tty`: 터미널 장치
- **특징**:
    - "가상 파일 시스템"으로 물리적 장치가 아닌 장치와의 인터페이스 역할
    - 커널이 동적으로 생성/삭제

---

#### **/etc/**

- **역할**: **시스템 전체 설정 파일**과 **호스트별 구성 파일** 저장.
- **예시**:
    - `/etc/passwd`: 사용자 계정 정보.
    - `/etc/fstab`: 파일 시스템 마운트 정보.
    - `/etc/network/interfaces`: 네트워크 설정.
- **서브 디렉토리**:
    - `/etc/opt/`: `/opt`에서 설치한 소프트웨어의 설정.
    - `/etc/sgml/`, `/etc/xml/`: SGML 및 XML 설정.

---
cd 
#### **/home/**

- **역할**: 사용자별 데이터와 설정 파일 저장.
- **내용물**:
    - 사용자의 개인 파일 및 환경 설정.
    - 각 사용자는 `/home/<username>` 디렉토리를 가짐.
- **특징**:
    - 별도의 파티션으로 분리하여 시스템 재설치 시 데이터 보호 가능

---

#### **/media/**

- **역할**: CD-ROM, USB 같은 **이동식 미디어**의 마운트 지점.
- **내용물**:
    - 사용자 디스크 삽입 시 동적으로 생성.
    - `/media/cdrom`, `/media/usb`와 같은 하위 디렉토리 포함.

---

#### **/mnt/**

- **역할**: 파일 시스템을 **임시로 마운트**할 때 사용.
- **특징**:
    - 시스템 관리자가 파일 시스템을 수동으로 마운트할 때 활용.
    - 오래된 표준으로, 이동식 미디어는 `/media`를 더 자주 사용.

---

#### **/proc/**

- **역할**: **커널과 프로세스 정보**를 보여주는 가상 파일 시스템.
- **내용물**:
    - `/proc/cpuinfo`: CPU 정보.
    - `/proc/meminfo`: 메모리 상태.
    - `/proc/<PID>/`: 특정 프로세스의 정보.
- **특징**:
    - 커널 상태를 파일 형태로 제공.
    - 읽기 전용으로 대부분 사용.

---

#### **/root/**

- **역할**: **루트 사용자**의 홈 디렉토리.
- **특징**:
    - `/home` 디렉토리가 아닌 `/root`에 위치.
    - 일반 사용자와는 분리된 환경 제공.

---

#### **/srv/**

- **역할**: **서비스에서 사용하는 데이터** 저장.
- **예시**:
    - 웹 서버 데이터: `/srv/www/`.
    - FTP 서버 데이터: `/srv/ftp/`.
- **특징**:
    - 서비스별로 특정 데이터를 구분하여 저장.

---

#### **/tmp/**

- **역할**: 임시 파일 저장.
- **특징**:
    - 재부팅 시 대부분의 파일이 삭제됨.
    - 임시로 생성되는 파일이나 프로세스 간 데이터 공유에 사용.
- **주의**:
    - 중요한 파일 저장에 적합하지 않음.

---

#### **/usr/**

- **역할**: **읽기 전용 사용자 데이터**와 유틸리티 저장.
- **내용물**:
    - `/usr/bin`: 비필수 사용자 명령어.
    - `/usr/lib`: `/usr/bin`과 `/usr/sbin`의 라이브러리.
    - `/usr/share`: 아키텍처 독립적인 데이터.
    - `/usr/src`: 소스 코드(커널 소스 포함).
- **특징**:
    - `/usr/local`은 특정 호스트에 맞춤 설치된 데이터를 포함.

---
### **1.2 주요 디렉토리 요약**

#### **필수 디렉토리**

| **디렉토리**    | **설명 및 역할**                                           |
| ----------- | ----------------------------------------------------- |
| **/**       | 루트 디렉토리, 파일 시스템의 최상위 경로.                              |
| **/boot/**  | 부팅 관련 파일 저장, 커널과 GRUB 설정 포함.                          |
| **/dev/**   | 장치 파일 저장, e.g., `/dev/null`, `/dev/sda`.              |
| **/etc/**   | 시스템 및 애플리케이션 설정 파일, e.g., `/etc/fstab`, `/etc/hosts`. |
| **/home/**  | 사용자 데이터 저장, 각 사용자의 홈 디렉토리 포함.                         |
| **/media/** | 이동식 미디어(CD-ROM, USB) 마운트 지점.                          |
| **/mnt/**   | 파일 시스템을 임시로 마운트할 때 사용.                                |
| **/root/**  | 루트 사용자의 홈 디렉토리.                                       |
| **/srv/**   | 서비스 데이터(e.g., 웹 서버 데이터).                              |
| **/tmp/**   | 임시 파일 저장, 재부팅 시 삭제됨.                                  |
| **/usr/**   | 읽기 전용 데이터 및 유틸리티 저장, e.g., `/usr/bin`, `/usr/lib`.    |


#### **특화 디렉토리**

| **디렉토리**        | **설명 및 역할**                    |
| --------------- | ------------------------------ |
| **/etc/opt/**   | `/opt` 소프트웨어의 설정 파일.           |
| **/usr/share/** | 아키텍처 독립적인 데이터(e.g., 아이콘, 로케일). |
| **/usr/src/**   | 소스 코드(e.g., 커널 소스 코드).         |
| **/var/log/**   | 시스템 로그 저장.                     |
| **/var/cache/** | 애플리케이션 캐시 데이터.                 |
| **/var/spool/** | 프린트 작업 및 이메일 대기열.              |

---

## **2. Network Setting**

### 2.1 네트워크 이중화란?**

- **정의**: 하나의 네트워크 경로나 인터페이스에 장애가 발생하더라도 다른 경로를 통해 서비스를 지속적으로 제공하는 기술.
- **이점**:
    - 장애 발생 시 서비스 다운타임 방지.
    - 로드 밸런싱으로 네트워크 대역폭 최적화.
    - 신뢰성과 안정성 향상.

### **2.2 주요 네트워크 이중화 기술**

1. **Bonding (NIC Teaming)**:
    - 여러 NIC(Network Interface Card)를 하나로 묶어 사용.
    - 부하 분산과 장애 복구 제공.
    - 모드 예시:
        - **active-backup** : 하나의 NIC만 활성화되고, 장애 발생 시 대체.
        - **balance-rr** : 트래픽을 모든 NIC에 순차적으로 전송.
        - **802.3ad (LACP)** : 링크 집계를 위한 표준 프로토콜.
        
2. **VRRP (Virtual Router Redundancy Protocol)**:
    - **가상 라우터**를 만들어 다중 라우터 환경에서 이중화 제공.
    - 마스터 라우터가 장애를 겪으면 **백업 라우터**로 자동 전환.
    - **Keepalived**에서 VRRP 지원.
      
3. **LACP (Link Aggregation Control Protocol)**:
    - IEEE 802.3ad 표준을 기반으로 한 **링크 집계 프로토콜**.
    - 스위치와 NIC 간 다중 연결을 하나의 논리적 연결로 묶어 대역폭 확장과 장애 복구 제공.
      
4. **Bridge (브릿지)**:
    - 가상화 환경에서 여러 네트워크 인터페이스를 연결.
    - VM 또는 컨테이너가 물리적 네트워크와 통신하도록 지원.
        

---

## **3. HA 개념 및 설정 (HAProxy & Keepalived)**

### **3.1 HA (High Availability)**

- **정의**: 장애 발생 시에도 서비스가 지속되도록 **고가용성**을 제공하는 기술.
- **중요 개념**:
    - **Failover**: 장애 시 자동으로 다른 노드로 전환.
    - **로드 밸런싱**: 트래픽을 여러 서버로 분산.

---

### **3.2 HAProxy**

- HAProxy란?
	- **정의**: 고성능 **로드 밸런서** 및 **프록시 서버**.
	- **역할**:
	    - 트래픽을 여러 서버로 분산.
	    - 장애가 발생한 서버를 제외하고 요청을 처리.
	    - HTTP, TCP, UDP 등 다양한 프로토콜 지원.
	- **특징**:
	    - 빠르고 가볍다.
	    - 백엔드 서버 상태를 지속적으로 모니터링.
	    - 고가용성과 확장성 제공.

---

- HAProxy의 구성 요소
	1. **Frontend**:
	    - 클라이언트와 직접 통신.
	    - 어떤 트래픽을 받아 어떤 백엔드로 보낼지 결정.
	    - **예**: `bind *:80` → 모든 IP에서 80번 포트 트래픽 수신.
	      
	2. **Backend**:
	    - 요청을 처리할 서버 그룹 정의.
	    - 부하 분산 방식 및 서버 상태 확인.
	      
	3. **Mode**:
	    - **HTTP**: HTTP 요청/응답을 기반으로 처리.
	    - **TCP**: 레이어 4에서 트래픽 처리.
	    - **UDP**: 비연결형 프로토콜 지원.
	      
	4. **Load Balancing Algorithms**:
	    - **roundrobin**: 서버 순환 방식.
	    - **leastconn**: 현재 연결이 가장 적은 서버 선택.
	    - **source**: 클라이언트 IP를 기준으로 서버 선택(세션 유지).

---

- HAProxy의 주요 기능
	1. **로드 밸런싱**:
	    - 요청을 여러 서버로 분산하여 서버 부하를 줄이고 응답 속도 향상.
	      
	2. **고가용성 (High Availability)**:
	    - 장애 발생 시 자동으로 요청을 다른 서버로 전환.
	      
	3. **SSL/TLS 종료**:
	    - HAProxy가 HTTPS 트래픽을 처리하고, 백엔드 서버는 HTTP로 통신.
	      
	4. **상태 모니터링**:
	    - 각 백엔드 서버의 상태를 주기적으로 확인.
	    - 서버가 비정상이면 요청을 차단.
	      
	5. **리디렉션 및 리라이팅**:
	    - 요청 URL을 변경하거나 다른 경로로 리디렉션 가능.
	      
	6. **프록시 캐싱**:
	    - 프록시 캐싱을 통해 성능 최적화.
    

---

### **3.3. HARPXOY 실습 

- 준비물 Server 4ea
	- Haproxy 2ea
	- backend 2ea
- Haproxy Install & Setting
  
- HINT
	/etc/sysctl.d
 
- VM Server
	- 10.3.2.187 taek-04
	- 10.3.2.188 dorong-04

- VIP 
	- 10.3.2.183 taek-04
	- 10.3.2.184 dorong-04
	- 10.3.2.185 taek-04
	- 10.3.2.186 dorong-04